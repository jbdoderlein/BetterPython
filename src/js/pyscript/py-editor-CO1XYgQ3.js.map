{"version":3,"file":"py-editor-CO1XYgQ3.js","sources":["../src/plugins/py-editor.js"],"sourcesContent":["// PyScript py-editor plugin\nimport { Hook, XWorker, dedent, defineProperties } from \"polyscript/exports\";\nimport { TYPES, offline_interpreter, relative_url, stdlib } from \"../core.js\";\n\nconst RUN_BUTTON = `<svg style=\"height:20px;width:20px;vertical-align:-.125em;transform-origin:center;overflow:visible;color:green\" viewBox=\"0 0 384 512\" aria-hidden=\"true\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\"><g transform=\"translate(192 256)\" transform-origin=\"96 0\"><g transform=\"translate(0,0) scale(1,1)\"><path d=\"M361 215C375.3 223.8 384 239.3 384 256C384 272.7 375.3 288.2 361 296.1L73.03 472.1C58.21 482 39.66 482.4 24.52 473.9C9.377 465.4 0 449.4 0 432V80C0 62.64 9.377 46.63 24.52 38.13C39.66 29.64 58.21 29.99 73.03 39.04L361 215z\" fill=\"currentColor\" transform=\"translate(-192 -256)\"></path></g></g></svg>`;\n\nlet id = 0;\nconst getID = (type) => `${type}-editor-${id++}`;\n\nconst envs = new Map();\nconst configs = new Map();\n\nconst hooks = {\n    worker: {\n        codeBeforeRun: () => stdlib,\n        // works on both Pyodide and MicroPython\n        onReady: ({ runAsync, io }, { sync }) => {\n            io.stdout = io.buffered(sync.write);\n            io.stderr = io.buffered(sync.writeErr);\n            sync.revoke();\n            sync.runAsync = runAsync;\n        },\n    },\n};\n\nasync function execute({ currentTarget }) {\n    const { env, pySrc, outDiv } = this;\n    const hasRunButton = !!currentTarget;\n\n    if (hasRunButton) {\n        currentTarget.disabled = true;\n        outDiv.innerHTML = \"\";\n    }\n\n    if (!envs.has(env)) {\n        const srcLink = URL.createObjectURL(new Blob([\"\"]));\n        const details = { type: this.interpreter };\n        const { config } = this;\n        if (config) {\n            details.configURL = relative_url(config);\n            if (config.endsWith(\".toml\")) {\n                const [{ parse }, toml] = await Promise.all([\n                    import(/* webpackIgnore: true */ \"../3rd-party/toml.js\"),\n                    fetch(config).then((r) => r.text()),\n                ]);\n                details.config = parse(toml);\n            } else if (config.endsWith(\".json\")) {\n                details.config = await fetch(config).then((r) => r.json());\n            } else {\n                details.configURL = relative_url(\"./config.txt\");\n                details.config = JSON.parse(config);\n            }\n            details.version = offline_interpreter(details.config);\n        } else {\n            details.config = {};\n        }\n\n        const xworker = XWorker.call(new Hook(null, hooks), srcLink, details);\n\n        const { sync } = xworker;\n        const { promise, resolve } = Promise.withResolvers();\n        envs.set(env, promise);\n        sync.revoke = () => {\n            URL.revokeObjectURL(srcLink);\n            resolve(xworker);\n        };\n    }\n\n    // wait for the env then set the target div\n    // before executing the current code\n    return envs.get(env).then((xworker) => {\n        xworker.onerror = ({ error }) => {\n            if (hasRunButton) {\n                outDiv.innerHTML += `<span style='color:red'>${\n                    error.message || error\n                }</span>\\n`;\n            }\n            console.error(error);\n        };\n\n        const enable = () => {\n            if (hasRunButton) currentTarget.disabled = false;\n        };\n        const { sync } = xworker;\n        sync.write = (str) => {\n            if (hasRunButton) outDiv.innerText += `${str}\\n`;\n        };\n        sync.writeErr = (str) => {\n            if (hasRunButton) {\n                outDiv.innerHTML += `<span style='color:red'>${str}</span>\\n`;\n            }\n        };\n        sync.runAsync(pySrc).then(enable, enable);\n    });\n}\n\nconst makeRunButton = (handler, type) => {\n    const runButton = document.createElement(\"button\");\n    runButton.className = `absolute ${type}-editor-run-button`;\n    runButton.innerHTML = RUN_BUTTON;\n    runButton.setAttribute(\"aria-label\", \"Python Script Run Button\");\n    runButton.addEventListener(\"click\", async (event) => {\n        runButton.blur();\n        await handler.handleEvent(event);\n    });\n    return runButton;\n};\n\nconst makeEditorDiv = (handler, type) => {\n    const editorDiv = document.createElement(\"div\");\n    editorDiv.className = `${type}-editor-input`;\n    editorDiv.setAttribute(\"aria-label\", \"Python Script Area\");\n\n    const runButton = makeRunButton(handler, type);\n    const editorShadowContainer = document.createElement(\"div\");\n\n    // avoid outer elements intercepting key events (reveal as example)\n    editorShadowContainer.addEventListener(\"keydown\", (event) => {\n        event.stopPropagation();\n    });\n\n    editorDiv.append(runButton, editorShadowContainer);\n\n    return editorDiv;\n};\n\nconst makeOutDiv = (type) => {\n    const outDiv = document.createElement(\"div\");\n    outDiv.className = `${type}-editor-output`;\n    outDiv.id = `${getID(type)}-output`;\n    return outDiv;\n};\n\nconst makeBoxDiv = (handler, type) => {\n    const boxDiv = document.createElement(\"div\");\n    boxDiv.className = `${type}-editor-box`;\n\n    const editorDiv = makeEditorDiv(handler, type);\n    const outDiv = makeOutDiv(type);\n    boxDiv.append(editorDiv, outDiv);\n\n    return [boxDiv, outDiv, editorDiv.querySelector(\"button\")];\n};\n\nconst init = async (script, type, interpreter) => {\n    const [\n        { basicSetup, EditorView },\n        { Compartment },\n        { python },\n        { indentUnit },\n        { keymap },\n        { defaultKeymap, indentWithTab },\n    ] = await Promise.all([\n        import(/* webpackIgnore: true */ \"../3rd-party/codemirror.js\"),\n        import(/* webpackIgnore: true */ \"../3rd-party/codemirror_state.js\"),\n        import(\n            /* webpackIgnore: true */ \"../3rd-party/codemirror_lang-python.js\"\n        ),\n        import(/* webpackIgnore: true */ \"../3rd-party/codemirror_language.js\"),\n        import(/* webpackIgnore: true */ \"../3rd-party/codemirror_view.js\"),\n        import(/* webpackIgnore: true */ \"../3rd-party/codemirror_commands.js\"),\n    ]);\n\n    let isSetup = script.hasAttribute(\"setup\");\n    const hasConfig = script.hasAttribute(\"config\");\n    const env = `${interpreter}-${script.getAttribute(\"env\") || getID(type)}`;\n\n    if (hasConfig && configs.has(env)) {\n        throw new SyntaxError(\n            configs.get(env)\n                ? `duplicated config for env: ${env}`\n                : `unable to add a config to the env: ${env}`,\n        );\n    }\n\n    configs.set(env, hasConfig);\n\n    let source = script.src\n        ? await fetch(script.src).then((b) => b.text())\n        : script.textContent;\n    const context = {\n        // allow the listener to be overridden at distance\n        handleEvent: execute,\n        interpreter,\n        env,\n        config: hasConfig && script.getAttribute(\"config\"),\n        get pySrc() {\n            return isSetup ? source : editor.state.doc.toString();\n        },\n        get outDiv() {\n            return isSetup ? null : outDiv;\n        },\n    };\n\n    let target;\n    defineProperties(script, {\n        target: { get: () => target },\n        handleEvent: {\n            get: () => context.handleEvent,\n            set: (callback) => {\n                // do not bother with logic if it was set back as its original handler\n                if (callback === execute) context.handleEvent = execute;\n                // in every other case be sure that if the listener override returned\n                // `false` nothing happens, otherwise keep doing what it always did\n                else {\n                    context.handleEvent = async (event) => {\n                        // trap the currentTarget ASAP (if any)\n                        // otherwise it gets lost asynchronously\n                        const { currentTarget } = event;\n                        // augment a code snapshot before invoking the override\n                        defineProperties(event, {\n                            code: { value: context.pySrc },\n                        });\n                        // avoid executing the default handler if the override returned `false`\n                        if ((await callback(event)) !== false)\n                            await execute.call(context, { currentTarget });\n                    };\n                }\n            },\n        },\n        code: {\n            get: () => context.pySrc,\n            set: (insert) => {\n                if (isSetup) return;\n                editor.update([\n                    editor.state.update({\n                        changes: {\n                            from: 0,\n                            to: editor.state.doc.length,\n                            insert,\n                        },\n                    }),\n                ]);\n            },\n        },\n        process: {\n            /**\n             * Simulate a setup node overriding the source to evaluate.\n             * @param {string} code the Python code to evaluate.\n             * @returns {Promise<...>} fulfill once code has been evaluated.\n             */\n            value(code) {\n                const wasSetup = isSetup;\n                const wasSource = source;\n                isSetup = true;\n                source = code;\n                const restore = () => {\n                    isSetup = wasSetup;\n                    source = wasSource;\n                };\n                return context\n                    .handleEvent({ currentTarget: null })\n                    .then(restore, restore);\n            },\n        },\n    });\n\n    const notify = () => {\n        const event = new Event(`${type}-editor`, { bubbles: true });\n        script.dispatchEvent(event);\n    };\n\n    if (isSetup) {\n        await context.handleEvent({ currentTarget: null });\n        notify();\n        return;\n    }\n\n    const selector = script.getAttribute(\"target\");\n\n    if (selector) {\n        target =\n            document.getElementById(selector) ||\n            document.querySelector(selector);\n        if (!target) throw new Error(`Unknown target ${selector}`);\n    } else {\n        target = document.createElement(`${type}-editor`);\n        target.style.display = \"block\";\n        script.after(target);\n    }\n\n    if (!target.id) target.id = getID(type);\n    if (!target.hasAttribute(\"exec-id\")) target.setAttribute(\"exec-id\", 0);\n    if (!target.hasAttribute(\"root\")) target.setAttribute(\"root\", target.id);\n\n    // @see https://github.com/JeffersGlass/mkdocs-pyscript/blob/main/mkdocs_pyscript/js/makeblocks.js\n    const [boxDiv, outDiv, runButton] = makeBoxDiv(context, type);\n    boxDiv.dataset.env = script.hasAttribute(\"env\") ? env : interpreter;\n\n    const inputChild = boxDiv.querySelector(`.${type}-editor-input > div`);\n    const parent = inputChild.attachShadow({ mode: \"open\" });\n    // avoid inheriting styles from the outer component\n    parent.innerHTML = `<style> :host { all: initial; }</style>`;\n\n    target.appendChild(boxDiv);\n\n    const doc = dedent(script.textContent).trim();\n\n    // preserve user indentation, if any\n    const indentation = /^([ \\t]+)/m.test(doc) ? RegExp.$1 : \"    \";\n\n    const listener = () => runButton.click();\n    const editor = new EditorView({\n        extensions: [\n            indentUnit.of(indentation),\n            new Compartment().of(python()),\n            keymap.of([\n                ...defaultKeymap,\n                { key: \"Ctrl-Enter\", run: listener, preventDefault: true },\n                { key: \"Cmd-Enter\", run: listener, preventDefault: true },\n                { key: \"Shift-Enter\", run: listener, preventDefault: true },\n                // @see https://codemirror.net/examples/tab/\n                indentWithTab,\n            ]),\n            basicSetup,\n        ],\n        foldGutter: true,\n        gutters: [\"CodeMirror-linenumbers\", \"CodeMirror-foldgutter\"],\n        parent,\n        doc,\n    });\n\n    editor.focus();\n    notify();\n};\n\n// avoid too greedy MutationObserver operations at distance\nlet timeout = 0;\n\n// avoid delayed initialization\nlet queue = Promise.resolve();\n\n// reset interval value then check for new scripts\nconst resetTimeout = () => {\n    timeout = 0;\n    pyEditor();\n};\n\n// triggered both ASAP on the living DOM and via MutationObserver later\nconst pyEditor = () => {\n    if (timeout) return;\n    timeout = setTimeout(resetTimeout, 250);\n    for (const [type, interpreter] of TYPES) {\n        const selector = `script[type=\"${type}-editor\"]`;\n        for (const script of document.querySelectorAll(selector)) {\n            // avoid any further bootstrap by changing the type as active\n            script.type += \"-active\";\n            // don't await in here or multiple calls might happen\n            // while the first script is being initialized\n            queue = queue.then(() => init(script, type, interpreter));\n        }\n    }\n    return queue;\n};\n\nnew MutationObserver(pyEditor).observe(document, {\n    childList: true,\n    subtree: true,\n});\n\n// try to check the current document ASAP\nexport default pyEditor();\n"],"names":["id","getID","type","envs","Map","configs","hooks","worker","codeBeforeRun","stdlib","onReady","runAsync","io","sync","stdout","buffered","write","stderr","writeErr","revoke","async","execute","currentTarget","env","pySrc","outDiv","this","hasRunButton","disabled","innerHTML","has","srcLink","URL","createObjectURL","Blob","details","interpreter","config","configURL","relative_url","endsWith","parse","toml","Promise","all","import","fetch","then","r","text","json","JSON","version","offline_interpreter","xworker","XWorker","call","Hook","promise","resolve","withResolvers","set","revokeObjectURL","get","onerror","error","message","console","enable","str","innerText","makeEditorDiv","handler","editorDiv","document","createElement","className","setAttribute","runButton","addEventListener","event","blur","handleEvent","makeRunButton","editorShadowContainer","stopPropagation","append","makeBoxDiv","boxDiv","makeOutDiv","querySelector","init","script","basicSetup","EditorView","Compartment","python","indentUnit","keymap","defaultKeymap","indentWithTab","n","x","q","isSetup","hasAttribute","hasConfig","getAttribute","SyntaxError","source","src","b","textContent","context","editor","state","doc","toString","target","defineProperties","callback","code","value","insert","update","changes","from","to","length","process","wasSetup","wasSource","restore","notify","Event","bubbles","dispatchEvent","selector","getElementById","Error","style","display","after","dataset","parent","attachShadow","mode","appendChild","dedent","trim","indentation","test","RegExp","$1","listener","click","extensions","of","key","run","preventDefault","foldGutter","gutters","focus","timeout","queue","resetTimeout","pyEditor","setTimeout","TYPES","querySelectorAll","MutationObserver","observe","childList","subtree","pyEditor$1"],"mappings":"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"}